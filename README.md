# Strapi Headless CMS using MongoDb Atlas

Strapi manages the data, roles and permissions, authentication, assets etc..The strapi exposes the data as json format. This tool, with a single command, will create both a complete Node API and administration panel for us to interact with our data.
(This project is for RootsMarket, a full-stack e-commerce application developed in react 16.10 )

Demo url for Strapi CMS : https://rootsmarket-strapi-cms.herokuapp.com/admin/ (username / password required)
Demo url for RootsMarket App: http://rootsmarket.herokuapp.com/

## MongoDb settings

1.Use [mongodb atlas](https://cloud.mongodb.com/) to create a database for the strapi.

2. Complete the cluster setup such as whitelist your IP( for production you need to change the settings again. Set username/password to the db.

3. Cluster connect method as 'connect your application'. note the cluster0-....mongodb.net for bootstrapping with strapi cli

https://strapi.io/documentation/3.0.0-alpha.x/getting-started/quick-start.html

## GitHub, local project, Strapi Settings

git clone https://github.com/arunharshan/rootsmarket-strapi-cms.git in your desired location in your computer CD to that folder.

```bash
npm install
```

Setup mongoDb atlas.

Go to config/environments/development/database.json

Provide appropriate values to username, password, host. (refer your mongodb atlas cluster setup)

```bash
strapi start
```

Goto http://localhost:1337/admin/

## New Porject Setup

warning: there is another cms avaliable in npm i strapi. So please run the below code

```bash
sudo npm install strapi@alpha -g
```

```bash
strapi new SERVER_FOLDER_NAME
```

Choose manual setup

MongoDb database

Server: optional

DatabaseName: optional

Host : cluster0-<your-cluser-details>.mongodb.net

Srv: true

Port: optional

username:<username and password for the cluster config>

password: **\*\***

Authentication database: ignore

Enable SSL : true

```bash
cd SERVER_FOLDER_NAME
strapi start
```

Goto http://localhost:1337/admin/

goto https://cloud.mongodb.com/ -> database collection to see autogenerated strapi tables.

## Usage

Goto http://localhost:1337/admin/ -> Content Type Builder to create a table, add content etc..
this will automatically add data into the mongoDb

Goto Roles and Permissions -> Public -> Edit -> Permissions - select find, find id etc...

**_Please refer image settings under Heroku deployment->( Image setting in Heroku APP with Cloudinary plugin)_**

### Push code to Git

step1: create git repo for strap cams
https://github.com/arunharshan/rootsmarket-strapi-cms.git
Go to local dev folder
git init

Step 1: Add package-lock.json to .gitignore at the very bottom

step 2: if needed change /config/environments/development/database.json variables

```
git add .
git commit -m “ first commit”
git remote add origin https://github.com/arunharshan/rootsmarket-strapi-cms.git (skip if you already have git repo)
git push -u origin master // git push origin
```

# Heroku Deployment

Reference link:
https://strapi.io/documentation/3.0.0-beta.x/guides/deployment.html#heroku

(heroku in arun.webdev account)

Step 1: You need to install heroku cli.
Step 2: make sure package-lock.jsons is added to the gitignore file

From command line type: heroku login
This will open the heroku login page. Provide login credentials and then close the browser on success.

If you already have a heroku app-name then ( I've already created an app rootsmarket-strapi-cms)

```
heroku git:remote [NAME-OF-YOUR-APP]
```

In return you could see https://git.heroku.com/rootsmarket-strapi-cms.git

### DB variable setup in heroku:

from mongoDB atlas

mongodb+srv://<userName>:<password>@cluster0-\*\*\*\*.mongodb.net/test?retryWrites=true&w=majority
Under the cluster you get the database name.
(or refer your development/database.json file)

Go to Heroku [YOUR-APP]

Set these 2 variables:

DATABASE_URI="mongodb+srv://<username>:<password>@cluster0-ur8y8.mongodb.net/test?retryWrites=true&w=majority"

DATABASE_NAME="my-database-name" (Eg : strapi-server)

Go to production/database.json file and replace with

```
{
 "defaultConnection": "default",
 "connections": {
   "default": {
     "connector": "strapi-hook-mongoose",
     "settings": {
       "uri": "${process.env.DATABASE_URI}",
       "database": "${process.env.DATABASE_NAME}"
     },
     "options": {
       "ssl": true
     }
   }
 }
}
```

```
 git add .
git commit -am "Changes the databse variables"
git push heroku master
heroku open

```

Then execute the deployment code:

```
git commit -m "first commit"
git push heroku master
heroku open
```

#### Image setting in Heroku APP with Cloudinary plugin

Since the heroku app clears the cache while it sleeps, he uploaded images will be removed since its stored locally

```
go to local folder [rootsmarket-strapi-cms]
cd plugin/uploads/
npm i --save strapi-provider-upload-cloudinary
git add .
git commit -m "cloudinary plugin installed"
Heroku->app-> make a deployment

```

Create an account in : https://cloudinary.com/

then goto: https://rootsmarket-strapi-cms.herokuapp.com/admin/ -> plugins/uploads

copy paste the credenitials from the coludinary into strapi.

Image upload size (1000 mb)

re upload images

#### You can deploy directly from the heroku app:

Step 1: go to your app in the heroku for me its "rootsmarket-strapi-cms"

Step 2: Set the variables as mentioned above

Step 3: Got to Deploy tab, ->deploy method as gitHub and connect your repo. ("rootsmarket-strapi-cms")

Step 4: Deploy

https://rootsmarket-strapi-cms.herokuapp.com/admin/
